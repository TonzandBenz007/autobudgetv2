<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard - AutoBudget</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Prompt', sans-serif; }
    body { background-color: #5c6a7e; color: #333; padding: 20px; padding-bottom: 80px; }

    /* Header */
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .logo { font-size: 24px; font-weight: bold; color: #2dce89; }
    .logo span { color: #1c1c1c; }
    .btn { padding: 10px 20px; background-color: #2dce89; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

    /* Summary Cards */
    .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.04); }
    .card .title { font-size: 16px; margin-bottom: 10px; color: #666; }
    .amount { font-size: 26px; font-weight: bold; }
    .green { color: #2dce89; } .red { color: #ff4d4f; }

    /* Modal */
    .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.4);}
    .modal-content { background-color:white; margin:10% auto; padding:20px; border-radius:10px; width:90%; max-width:400px; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
    .close { color:#aaa; float:right; font-size:24px; font-weight:bold; cursor:pointer;}
    .close:hover { color:#000;}

    /* Navigation bar */
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: white;
      border-top: 2px solid #e2e2e2;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
      z-index: 999;
    }
    nav a {
      text-decoration: none;
      color: #444;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      transition: 0.3s;
    }
    nav a:hover, nav a.active {
      color: #2dce89;
    }
    nav a span {
      display: block;
      font-size: 20px;
      margin-bottom: 2px;
    }
  </style>
</head>
<body>

<!-- Header -->
<div class="header-top">
  <div class="logo">
    Auto<span>Budget</span><br>
    <small style="font-size: 14px; font-weight: normal;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</small>
  </div>
  <div class="button-group">
    <button class="btn" onclick="openModal()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</button>
  </div>
</div>

<!-- Summary -->
<div class="summary">
  <div class="card"><div class="title">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div><div class="amount green" id="income">‡∏ø0</div></div>
  <div class="card"><div class="title">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</div><div class="amount red" id="expense">‡∏ø0</div></div>
  <div class="card"><div class="title">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div><div class="amount" id="remain">‡∏ø0</div></div>
</div>

<!-- Modal -->
<div id="transactionModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h2>
    <form id="transactionForm">
      <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</label><br>
      <label><input type="radio" name="type" value="income" checked> ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</label>
      <label><input type="radio" name="type" value="expense"> ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</label><br><br>

      <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
      <input type="number" id="amount" required style="width:100%; padding:8px;"><br><br>

      <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
      <select id="category" style="width:100%; padding:8px;">
        <option value="food">‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
        <option value="home">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢</option>
        <option value="transport">‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
        <option value="entertainment">‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
      </select><br><br>

      <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
      <textarea id="note" rows="2" style="width:100%; padding:8px;"></textarea><br><br>

      <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
      <input type="date" id="date" style="width:100%; padding:8px;"><br><br>

      <div style="text-align:right;">
        <button type="button" onclick="closeModal()" style="padding:10px 20px; background:#ccc;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" style="padding:10px 20px; background:#22c55e; color:white;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </div>
</div>

<!-- Bottom Navigation -->
<nav>
  <a href="dashboard.html" class="active"><span>üè†</span>Dashboard</a>
  <a href="transactions.html"><span>üìÑ</span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</a>
  <a href="Expense categories.html"><span>üìä</span>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</a>
  <a href="Spending.html"><span>üìÜ</span>‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</a>
  <a href="notifications.html"><span>üîî</span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</a>
</nav>

<!-- Modal Script -->
<script>
  // ‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î Modal
  window.openModal = function() { document.getElementById("transactionModal").style.display = "block"; }
  window.closeModal = function() { document.getElementById("transactionModal").style.display = "none"; }
  window.onclick = function(e) { if(e.target==document.getElementById("transactionModal")) closeModal(); }
</script>

<!-- Firebase Module -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyChSRFqpU-n-h0ZwI02Q-9JHFDnO1Ti0Iw",
    authDomain: "piegraph-9d210.firebaseapp.com",
    projectId: "piegraph-9d210",
    storageBucket: "piegraph-9d210.appspot.com",
    messagingSenderId: "966818446316",
    appId: "1:966818446316:web:8a0c28211d0a20ec081ec9",
    measurementId: "G-PFJJKT57QH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const transactionsRef = collection(db, "transactions");

  // Real-time Dashboard
  onSnapshot(transactionsRef, (snapshot) => {
    let income = 0, expense = 0;
    snapshot.forEach(doc => {
      const d = doc.data();
      if(d.type==="income") income+=Number(d.amount)||0;
      else if(d.type==="expense") expense+=Number(d.amount)||0;
    });
    document.getElementById("income").textContent=`‡∏ø${income.toLocaleString()}`;
    document.getElementById("expense").textContent=`‡∏ø${expense.toLocaleString()}`;
    document.getElementById("remain").textContent=`‡∏ø${(income-expense).toLocaleString()}`;
  });

  // Save Transaction
  document.getElementById("transactionForm").addEventListener("submit", async(e)=>{
    e.preventDefault();
    const type=document.querySelector("input[name='type']:checked").value;
    const amount=parseFloat(document.getElementById("amount").value);
    const category=document.getElementById("category").value;
    const note=document.getElementById("note").value.trim();
    const date=document.getElementById("date").value||new Date().toISOString().split("T")[0];

    if(!amount||amount<=0) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

    try {
      await addDoc(transactionsRef, {type, amount, category, note, date, created_at: new Date().toISOString()});
      alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
      window.closeModal();
      document.getElementById("transactionForm").reset();
    } catch(err) {
      console.error("Error adding document:", err);
      alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + err.message);
    }
  });
</script>

</body>
</html>
